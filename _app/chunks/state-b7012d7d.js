var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r,n=(e,t)=>{for(var i in t||(t={}))a.call(t,i)&&s(e,i,t[i]);if(r)for(var i of r(t))o.call(t,i)&&s(e,i,t[i]);return e},c=(e,r)=>t(e,i(r));import{D as d,H as l,R as y,L as v,I as w,C as u,J as p}from"./vendor-dbf4a16c.js";const m={READY:{key:"ready",label:"Próximo"},DONE:{key:"done",label:"Finalizado"},WAITING:{key:"waiting",label:"Aguardando"}},_={NO_RECURRENCE:{key:"no_recurrence",label:"Sem recorrência"},EVERY_WEEK_DAYS:{key:"every_week_days",label:"Por dias da semana"},EVERY_MONTH_DAYS:{key:"every_month_days",label:"Por dias do mês"}},f=()=>"undefined"!=typeof window,g=({type:e,weekdays:t,monthDays:i},r=d.now())=>{switch(e){case _.NO_RECURRENCE.key:return"";case _.EVERY_WEEK_DAYS.key:{if(!t.size)return"";const e=r.startOf("day"),i=e.weekday,a=[...t.map((e=>+e)),...t.map((e=>+e+7))].sort(((e,t)=>e-t)).find((e=>e>i));return e.plus({days:a-i}).toUTC().toISO()}case _.EVERY_MONTH_DAYS.key:{if(!i.size)return"";const e=r.startOf("day"),t=e.day,a=[...i.map((e=>+e)),...i.map((t=>+t+e.daysInMonth))].sort().find((e=>e>t));return e.plus({days:a-t}).toUTC().toISO()}default:return console.error(`Returning empty next date. No match for recurrence type "${e}".`),""}};let h;f()&&(h=new l("pronto"),h.version(3).stores({activities:"_id,order"}),window.dexieDb=h);const k=(e={})=>y({type:"no_recurrence",weekdays:v(),monthDays:v(),nextDate:""},"Recurrence")(c(n({},e),{weekdays:v(e.weekdays),monthDays:v(e.monthDays)})),E=(e={})=>y({_id:"",name:"",checked:!1})(c(n({},e),{_id:w()})),I=(e={})=>{var t,i;return y({_id:"",title:"",description:"",order:0,state:m.READY.key,recurrence:k(),checkList:v(),createdAt:"",completedAt:"",workIntervals:v()},"Activity")(c(n({_id:w()},e),{recurrence:k(e.recurrence),checkList:v((null==(i=null==(t=e.checkList)?void 0:t.map)?void 0:i.call(t,E))||[]),workIntervals:v(e.workIntervals||[])}))},A=(e={})=>y({showDoneActivities:!1,showWaitingActivities:!0},"Config")(n({},e)),b=y({activities:v(),config:A()},"State"),D=u(b()),O=e=>(...t)=>D.update((i=>e(i,...t))),S=O(((e,t)=>{const i=e.activities.findIndex((e=>e._id===t._id)),r=t._id?t:t.merge({createdAt:d.utc().toISO(),order:e.activities.size}),a=i<0?e.activities.push(r):e.activities.set(i,r),o=e.set("activities",a);return h.activities.put(r.toJS(),r._id).catch((i=>{console.error("Error on updating activity: ",{activity:t,error:i}),D.set(e)})),o})),R=O(((e,t)=>{const i=e.activities.findIndex((e=>e._id===t._id)),{_id:r}=e.activities.get(i),a=e.update("activities",(e=>e.delete(i)));return h.activities.where({_id:r}).delete().catch((i=>{console.error("Error on deleting activity: ",{activity:t,error:i}),D.set(e)})),a})),C=O(((e,t)=>{const i=t.reduce(((e,{_id:t},i)=>c(n({},e),{[t]:i})),{}),r=e.activities.map((e=>{var t;return e.set("order",null!=(t=i[e._id])?t:e.order)})).sort(((e,t)=>e.order-t.order)),a=e.set("activities",r);return h.transaction("rw",h.activities,(async()=>r.map((e=>h.activities.update(e._id,{order:e.order}))))).catch((t=>{console.error("Error on reordering activities: ",{activities:e.activities,newActivities:r,error:t}),D.set(e)})),a})),N=O(((e,t)=>{const i=e.set("config",t);return Object.keys(t.toJS()).forEach((e=>{console.log("setting",e,t.get(e)),localStorage.setItem(e,t.get(e))})),i})),x=e=>{const t=g(e.recurrence);console.info(`Completing activity with next date: ${t}`,e),S(e.set("state",t?m.WAITING.key:m.DONE.key).set("completedAt",d.utc().toISO()).setIn(["recurrence","nextDate"],t).setIn(["workIntervals"],v()).updateIn(["checkList"],(e=>e.map((e=>e.set("checked",!1))))))},Y=async()=>{const e=await h.activities.orderBy("order").toArray();D.set(b({activities:v(e.map(I)),config:A({showDoneActivities:"true"===localStorage.getItem("showDoneActivities"),showWaitingActivities:"true"===localStorage.getItem("showWaitingActivities")})}))};f()&&(window.appState=D,window.dexieDb=h,window.DateTime=d,window.Interval=p,window.List=v,window.Record=y,window.Config=A,window.refreshState=Y,Y());export{I as A,E as C,_ as R,m as a,k as b,g as c,h as d,x as e,C as f,N as g,D as h,f as i,R as r,S as s};
