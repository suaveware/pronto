var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,c=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,o=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&c(e,s,t[s]);if(i)for(var s of i(t))r.call(t,s)&&c(e,s,t[s]);return e},n=(e,i)=>t(e,s(i));import{ak as l,al as d,a9 as u,am as v,C as p,G as m,an as f,S as w,i as h,s as g,D as $,e as y,j as k,k as b,c as I,a as A,m as D,n as O,d as _,b as x,K as S,f as E,o as j,H as R,J as C,a0 as L,r as N,u as P,v as T,w as W,x as G,E as z,B,N as J,O as Y}from"./vendor-d03ab36e.js";import{i as F,A as H,a as K,c as U}from"./tick-9a5f09cc.js";let V;F()&&(V=new l("pronto"),V.version(3).stores({activities:"_id,order"}),window.dexieDb=V);const q=(e={})=>d({type:"no_recurrence",weekdays:u(),monthDays:u(),nextDate:""},"Recurrence")(n(o({},e),{weekdays:u(e.weekdays),monthDays:u(e.monthDays)})),M=(e={})=>d({_id:"",name:"",checked:!1})(o({_id:v()},e)),Q=(e={})=>{var t,s;return d({_id:"",title:"",description:"",order:0,state:H.READY.key,recurrence:q(),checkList:u(),createdAt:"",completedAt:"",workIntervals:u()},"Activity")(n(o({_id:v()},e),{recurrence:q(e.recurrence),checkList:u((null==(s=null==(t=e.checkList)?void 0:t.map)?void 0:s.call(t,M))||[]),workIntervals:u(e.workIntervals||[])}))},X=(e={})=>d({showDoneActivities:!1,showWaitingActivities:!0},"Config")(o({},e)),Z=d({activities:u(),config:X()},"State");F()&&(window.List=u,window.Record=d,window.Config=X);const ee=p(Z()),te=e=>(...t)=>ee.update((s=>e(s,...t))),se=te(((e,t)=>{const s=e.activities.findIndex((e=>e._id===t._id)),i=s>=0?t:t.merge({createdAt:m.utc().toISO(),order:e.activities.size}),a=s<0?e.activities.push(i):e.activities.set(s,i),r=e.set("activities",a);return V.activities.put(i.toJS(),i._id).catch((s=>{console.error("Error on updating activity: ",{activity:t,error:s}),ee.set(e)})),r})),ie=te(((e,t)=>{const s=e.activities.findIndex((e=>e._id===t._id)),{_id:i}=e.activities.get(s),a=e.update("activities",(e=>e.delete(s)));return V.activities.where({_id:i}).delete().catch((s=>{console.error("Error on deleting activity: ",{activity:t,error:s}),ee.set(e)})),a})),ae=te(((e,t)=>{const s=t.reduce(((e,{_id:t},s)=>n(o({},e),{[t]:s})),{}),i=e.activities.map((e=>{var t;return e.set("order",null!=(t=s[e._id])?t:e.order)})).sort(((e,t)=>e.order-t.order)),a=e.set("activities",i);return V.transaction("rw",V.activities,(async()=>i.map((e=>V.activities.update(e._id,{order:e.order}))))).catch((t=>{console.error("Error on reordering activities: ",{activities:e.activities,newActivities:i,error:t}),ee.set(e)})),a})),re=te(((e,t)=>{const s=e.set("config",t);return Object.keys(t.toJS()).forEach((e=>{console.log("setting",e,t.get(e)),localStorage.setItem(e,t.get(e))})),s})),ce=e=>{const t=U(e.recurrence);console.info(`Completing activity with next date: ${t}`,e),se(e.set("state",t?H.WAITING.key:H.DONE.key).set("completedAt",m.utc().toISO()).setIn(["recurrence","nextDate"],t).setIn(["workIntervals"],u()).updateIn(["checkList"],(e=>e.map((e=>e.set("checked",!1))))))},oe=te((e=>e.update("activities",(e=>e.map((e=>e.state===H.WAITING.key&&m.now()>=m.fromISO(e.nextDate)?e.set("state",H.READY.key):e)))))),ne=async()=>{const e=await V.activities.orderBy("order").toArray(),t=u(e.map(Q));ee.set(Z({activities:t,config:X({showDoneActivities:"true"===localStorage.getItem("showDoneActivities"),showWaitingActivities:"true"===localStorage.getItem("showWaitingActivities")})}))};F()&&(window.appState=ee,window.DateTime=m,window.Interval=f,window.refreshState=ne,window.checkRecurrencies=oe,ne(),K(oe));function le(e){let t,s,i,a,r,c,o;var n=e[1];function l(e){return{props:{size:e[0]?"20":"28"}}}n&&(s=new n(l(e)));const d=e[5].default,u=$(d,e,e[4],null);return{c(){t=y("button"),s&&k(s.$$.fragment),i=b(),u&&u.c(),this.h()},l(e){t=I(e,"BUTTON",{class:!0});var a=A(t);s&&D(s.$$.fragment,a),i=O(a),u&&u.l(a),a.forEach(_),this.h()},h(){x(t,"class",a="fab "+e[2]+" "+e[3].class+" svelte-1i3gsle"),S(t,"small",e[0])},m(a,n){E(a,t,n),s&&j(s,t,null),R(t,i),u&&u.m(t,null),r=!0,c||(o=C(t,"click",L(e[6])),c=!0)},p(e,[c]){const o={};if(1&c&&(o.size=e[0]?"20":"28"),n!==(n=e[1])){if(s){N();const e=s;P(e.$$.fragment,1,0,(()=>{T(e,1)})),W()}n?(s=new n(l(e)),k(s.$$.fragment),G(s.$$.fragment,1),j(s,t,i)):s=null}else n&&s.$set(o);u&&u.p&&(!r||16&c)&&z(u,d,e,e[4],r?c:-1,null,null),(!r||12&c&&a!==(a="fab "+e[2]+" "+e[3].class+" svelte-1i3gsle"))&&x(t,"class",a),13&c&&S(t,"small",e[0])},i(e){r||(s&&G(s.$$.fragment,e),G(u,e),r=!0)},o(e){s&&P(s.$$.fragment,e),P(u,e),r=!1},d(e){e&&_(t),s&&T(s),u&&u.d(e),c=!1,o()}}}function de(e,t,s){let{$$slots:i={},$$scope:a}=t,{small:r=!1}=t,{icon:c=null}=t,{color:o="bg-blueGray-500"}=t;return e.$$set=e=>{s(3,t=B(B({},t),J(e))),"small"in e&&s(0,r=e.small),"icon"in e&&s(1,c=e.icon),"color"in e&&s(2,o=e.color),"$$scope"in e&&s(4,a=e.$$scope)},t=J(t),[r,c,o,t,a,i,function(t){Y.call(this,e,t)}]}class ue extends w{constructor(e){super(),h(this,e,de,le,g,{small:0,icon:1,color:2})}}function ve(e){let t,s;const i=e[1].default,a=$(i,e,e[0],null);return{c(){t=y("div"),a&&a.c(),this.h()},l(e){t=I(e,"DIV",{class:!0});var s=A(t);a&&a.l(s),s.forEach(_),this.h()},h(){x(t,"class","fixed bottom-4 right-4 gap-3 items-center inline-flex flex-col")},m(e,i){E(e,t,i),a&&a.m(t,null),s=!0},p(e,[t]){a&&a.p&&(!s||1&t)&&z(a,i,e,e[0],s?t:-1,null,null)},i(e){s||(G(a,e),s=!0)},o(e){P(a,e),s=!1},d(e){e&&_(t),a&&a.d(e)}}}function pe(e,t,s){let{$$slots:i={},$$scope:a}=t;return e.$$set=e=>{"$$scope"in e&&s(0,a=e.$$scope)},[a,i]}class me extends w{constructor(e){super(),h(this,e,pe,ve,g,{})}}export{Q as A,M as C,me as F,q as R,ae as a,re as b,ce as c,ue as d,ee as e,ie as r,se as s};
