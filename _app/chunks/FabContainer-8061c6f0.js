var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,o=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&n(e,s,t[s]);if(i)for(var s of i(t))r.call(t,s)&&n(e,s,t[s]);return e},c=(e,i)=>t(e,s(i));import{aj as l,ak as d,a6 as u,al as h,C as v,G as m,am as p,S as w,i as f,s as $,e as g,E as y,c as b,d as k,b as I,H as A,I as D,P as _,D as O,j as S,k as x,a as E,m as j,n as C,K as N,f as T,o as z,J as P,a0 as R,r as L,u as W,v as B,w as G,x as J,F,B as Y,N as H,O as K}from"./vendor-c3741222.js";import{i as M,A as U,a as V,c as q}from"./tick-cf308ed2.js";let Q;M()&&(Q=new l("pronto"),Q.version(3).stores({activities:"_id,order"}),window.dexieDb=Q);const X=(e={})=>d({type:"no_recurrence",weekdays:u(),monthDays:u(),nextDate:""},"Recurrence")(c(o({},e),{weekdays:u(e.weekdays),monthDays:u(e.monthDays)})),Z=(e={})=>d({_id:"",name:"",checked:!1})(o({_id:h()},e)),ee=(e={})=>{var t,s;return d({_id:"",title:"",description:"",order:0,state:U.READY.key,recurrence:X(),checkList:u(),createdAt:"",completedAt:"",workIntervals:u()},"Activity")(c(o({_id:h()},e),{recurrence:X(e.recurrence),checkList:u((null==(s=null==(t=e.checkList)?void 0:t.map)?void 0:s.call(t,Z))||[]),workIntervals:u(e.workIntervals||[])}))},te=(e={})=>d({showDoneActivities:!1,showWaitingActivities:!0,theme:""},"Config")(o({},e)),se=d({activities:u(),config:te()},"State");M()&&(window.List=u,window.Record=d,window.Config=te);const ie=v(se()),ae=e=>(...t)=>ie.update((s=>e(s,...t))),re=ae(((e,t)=>{const s=e.activities.findIndex((e=>e._id===t._id)),i=s>=0?t:t.merge({createdAt:m.utc().toISO(),order:e.activities.size}),a=s<0?e.activities.push(i):e.activities.set(s,i),r=e.set("activities",a);return Q.activities.put(i.toJS(),i._id).catch((s=>{console.error("Error on updating activity: ",{activity:t,error:s}),ie.set(e)})),r})),ne=ae(((e,t)=>{const s=e.activities.findIndex((e=>e._id===t._id)),{_id:i}=e.activities.get(s),a=e.update("activities",(e=>e.delete(s)));return Q.activities.where({_id:i}).delete().catch((s=>{console.error("Error on deleting activity: ",{activity:t,error:s}),ie.set(e)})),a})),oe=ae(((e,t)=>{const s=t.reduce(((e,{_id:t},s)=>c(o({},e),{[t]:s})),{}),i=e.activities.map((e=>{var t;return e.set("order",null!=(t=s[e._id])?t:e.order)})).sort(((e,t)=>e.order-t.order)),a=e.set("activities",i);return Q.transaction("rw",Q.activities,(async()=>i.map((e=>Q.activities.update(e._id,{order:e.order}))))).catch((t=>{console.error("Error on reordering activities: ",{activities:e.activities,newActivities:i,error:t}),ie.set(e)})),a})),ce=ae(((e,t)=>{const s=e.set("config",t);return Object.keys(t.toJS()).forEach((e=>{localStorage.setItem(e,t.get(e))})),s})),le=e=>{const t=q(e.recurrence);console.info(`Completing activity with next date: ${t}`,e),re(e.set("state",t?U.WAITING.key:U.DONE.key).set("completedAt",m.utc().toISO()).setIn(["recurrence","nextDate"],t).setIn(["workIntervals"],u()).updateIn(["checkList"],(e=>e.map((e=>e.set("checked",!1))))))},de=(e,t)=>re(e.set("state",t)),ue=ae((e=>{const t=e.update("activities",(e=>e.map((e=>e.state===U.WAITING.key&&m.now()>=m.fromISO(e.recurrence.nextDate)?e.set("state",U.READY.key):e))));return Q.transaction("rw",Q.activities,(async()=>t.activities.map((e=>Q.activities.update(e._id,{state:e.state}))))).catch((t=>{console.error("Error on reordering activities: ",{activities:e.activities,newActivities:newActivities,error:t}),ie.set(e)})),t})),he=async()=>{const e=await Q.activities.orderBy("order").toArray(),t=u(e.map(ee));ie.set(se({activities:t,config:te({showDoneActivities:"true"===localStorage.getItem("showDoneActivities"),showWaitingActivities:"true"===localStorage.getItem("showWaitingActivities"),theme:localStorage.getItem("theme")})}))};function ve(e){let t;return{c(){t=g("meta"),this.h()},l(e){const s=y('[data-svelte="svelte-1frfhyh"]',document.head);t=b(s,"META",{name:!0,content:!0}),s.forEach(k),this.h()},h(){I(t,"name","theme-color"),I(t,"content",e[1])},m(s,i){A(document.head,t),e[3](t)},p(e,[s]){2&s&&I(t,"content",e[1])},i:D,o:D,d(s){k(t),e[3](null)}}}function me(e,t,s){let{themeColoredNode:i=null}=t,a=null,r="";return e.$$set=e=>{"themeColoredNode"in e&&s(2,i=e.themeColoredNode)},e.$$.update=()=>{7&e.$$.dirty&&i&&a&&(s(1,r=window.getComputedStyle(i).backgroundColor),s(0,a.content=r,a))},[a,r,i,function(e){_[e?"unshift":"push"]((()=>{a=e,s(0,a),s(2,i),s(1,r)}))}]}M()&&(window.appState=ie,window.DateTime=m,window.Interval=p,window.refreshState=he,window.checkRecurrencies=ue,he(),V(ue));class pe extends w{constructor(e){super(),f(this,e,me,ve,$,{themeColoredNode:2})}}function we(e){let t,s,i,a,r,n,o;var c=e[1];function l(e){return{props:{size:e[0]?"20":"28"}}}c&&(s=new c(l(e)));const d=e[4].default,u=O(d,e,e[3],null);return{c(){t=g("button"),s&&S(s.$$.fragment),i=x(),u&&u.c(),this.h()},l(e){t=b(e,"BUTTON",{class:!0});var a=E(t);s&&j(s.$$.fragment,a),i=C(a),u&&u.l(a),a.forEach(k),this.h()},h(){I(t,"class",a="btn btn-lg btn-circle shadow-md "+e[2].class+" svelte-hznbn8"),N(t,"small",e[0])},m(a,c){T(a,t,c),s&&z(s,t,null),A(t,i),u&&u.m(t,null),r=!0,n||(o=P(t,"click",R(e[5])),n=!0)},p(e,[n]){const o={};if(1&n&&(o.size=e[0]?"20":"28"),c!==(c=e[1])){if(s){L();const e=s;W(e.$$.fragment,1,0,(()=>{B(e,1)})),G()}c?(s=new c(l(e)),S(s.$$.fragment),J(s.$$.fragment,1),z(s,t,i)):s=null}else c&&s.$set(o);u&&u.p&&(!r||8&n)&&F(u,d,e,e[3],r?n:-1,null,null),(!r||4&n&&a!==(a="btn btn-lg btn-circle shadow-md "+e[2].class+" svelte-hznbn8"))&&I(t,"class",a),5&n&&N(t,"small",e[0])},i(e){r||(s&&J(s.$$.fragment,e),J(u,e),r=!0)},o(e){s&&W(s.$$.fragment,e),W(u,e),r=!1},d(e){e&&k(t),s&&B(s),u&&u.d(e),n=!1,o()}}}function fe(e,t,s){let{$$slots:i={},$$scope:a}=t,{small:r=!1}=t,{icon:n=null}=t;return e.$$set=e=>{s(2,t=Y(Y({},t),H(e))),"small"in e&&s(0,r=e.small),"icon"in e&&s(1,n=e.icon),"$$scope"in e&&s(3,a=e.$$scope)},t=H(t),[r,n,t,a,i,function(t){K.call(this,e,t)}]}class $e extends w{constructor(e){super(),f(this,e,fe,we,$,{small:0,icon:1})}}function ge(e){let t,s;const i=e[1].default,a=O(i,e,e[0],null);return{c(){t=g("div"),a&&a.c(),this.h()},l(e){t=b(e,"DIV",{class:!0});var s=E(t);a&&a.l(s),s.forEach(k),this.h()},h(){I(t,"class","absolute bottom-4 right-4 gap-3 items-center inline-flex flex-col z-20")},m(e,i){T(e,t,i),a&&a.m(t,null),s=!0},p(e,[t]){a&&a.p&&(!s||1&t)&&F(a,i,e,e[0],s?t:-1,null,null)},i(e){s||(J(a,e),s=!0)},o(e){W(a,e),s=!1},d(e){e&&k(t),a&&a.d(e)}}}function ye(e,t,s){let{$$slots:i={},$$scope:a}=t;return e.$$set=e=>{"$$scope"in e&&s(0,a=e.$$scope)},[a,i]}class be extends w{constructor(e){super(),f(this,e,ye,ge,$,{})}}export{ee as A,Z as C,be as F,X as R,pe as T,de as a,ce as b,le as c,oe as d,$e as e,ie as f,ne as r,re as s};
