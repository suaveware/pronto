var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,n=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,c=(e,t)=>{for(var s in t||(t={}))r.call(t,s)&&n(e,s,t[s]);if(i)for(var s of i(t))a.call(t,s)&&n(e,s,t[s]);return e},o=(e,i)=>t(e,s(i));import{aj as l,ak as d,a6 as u,al as v,C as h,G as m,am as p,S as f,i as w,s as $,e as g,E as y,c as b,d as k,b as I,H as A,I as D,P as _,D as O,j as S,k as x,a as E,m as j,n as C,K as N,f as T,o as P,J as R,a0 as z,r as L,u as W,v as B,w as G,x as J,F,B as Y,N as H,O as K}from"./vendor-c3741222.js";import{i as M,A as U,a as V,c as q}from"./tick-cf308ed2.js";let Q;M()&&(Q=new l("pronto"),Q.version(3).stores({activities:"_id,order"}),window.dexieDb=Q);const X=(e={})=>d({type:"no_recurrence",weekdays:u(),monthDays:u(),nextDate:""},"Recurrence")(o(c({},e),{weekdays:u(e.weekdays),monthDays:u(e.monthDays)})),Z=(e={})=>d({_id:"",name:"",checked:!1})(c({_id:v()},e)),ee=(e={})=>{var t,s;return d({_id:"",title:"",description:"",order:0,state:U.READY.key,recurrence:X(),checkList:u(),createdAt:"",completedAt:"",workIntervals:u()},"Activity")(o(c({_id:v()},e),{recurrence:X(e.recurrence),checkList:u((null==(s=null==(t=e.checkList)?void 0:t.map)?void 0:s.call(t,Z))||[]),workIntervals:u(e.workIntervals||[])}))},te=(e={})=>d({showDoneActivities:!1,showWaitingActivities:!0,theme:""},"Config")(c({},e)),se=d({activities:u(),config:te()},"State");M()&&(window.List=u,window.Record=d,window.Config=te);const ie=h(se()),re=e=>(...t)=>ie.update((s=>e(s,...t))),ae=re(((e,t)=>{const s=e.activities.findIndex((e=>e._id===t._id)),i=s>=0?t:t.merge({createdAt:m.utc().toISO(),order:e.activities.size}),r=s<0?e.activities.push(i):e.activities.set(s,i),a=e.set("activities",r);return Q.activities.put(i.toJS(),i._id).catch((s=>{console.error("Error on updating activity: ",{activity:t,error:s}),ie.set(e)})),a})),ne=re(((e,t)=>{const s=e.activities.findIndex((e=>e._id===t._id)),{_id:i}=e.activities.get(s),r=e.update("activities",(e=>e.delete(s)));return Q.activities.where({_id:i}).delete().catch((s=>{console.error("Error on deleting activity: ",{activity:t,error:s}),ie.set(e)})),r})),ce=re(((e,t)=>{const s=t.reduce(((e,{_id:t},s)=>o(c({},e),{[t]:s})),{}),i=e.activities.map((e=>{var t;return e.set("order",null!=(t=s[e._id])?t:e.order)})).sort(((e,t)=>e.order-t.order)),r=e.set("activities",i);return Q.transaction("rw",Q.activities,(async()=>i.map((e=>Q.activities.update(e._id,{order:e.order}))))).catch((t=>{console.error("Error on reordering activities: ",{activities:e.activities,newActivities:i,error:t}),ie.set(e)})),r})),oe=re(((e,t)=>{const s=e.set("config",t);return Object.keys(t.toJS()).forEach((e=>{localStorage.setItem(e,t.get(e))})),s})),le=e=>{const t=q(e.recurrence);console.info(`Completing activity with next date: ${t}`,e),ae(e.set("state",t?U.WAITING.key:U.DONE.key).set("completedAt",m.utc().toISO()).setIn(["recurrence","nextDate"],t).setIn(["workIntervals"],u()).updateIn(["checkList"],(e=>e.map((e=>e.set("checked",!1))))))},de=(e,t)=>ae(e.set("state",t)),ue=re((e=>{const t=e.update("activities",(e=>e.map((e=>e.state===U.WAITING.key&&m.now()>=m.fromISO(e.recurrence.nextDate)?e.set("state",U.READY.key):e))));return Q.transaction("rw",Q.activities,(async()=>t.activities.map((e=>Q.activities.update(e._id,{state:e.state}))))).catch((t=>{console.error("Error on reordering activities: ",{activities:e.activities,newActivities:newActivities,error:t}),ie.set(e)})),t})),ve=async()=>{const e=await Q.activities.orderBy("order").toArray(),t=u(e.map(ee));ie.set(se({activities:t,config:te({showDoneActivities:"true"===localStorage.getItem("showDoneActivities"),showWaitingActivities:"true"===localStorage.getItem("showWaitingActivities"),theme:localStorage.getItem("theme")})}))};function he(e){let t;return{c(){t=g("meta"),this.h()},l(e){const s=y('[data-svelte="svelte-1frfhyh"]',document.head);t=b(s,"META",{name:!0,content:!0}),s.forEach(k),this.h()},h(){I(t,"name","theme-color"),I(t,"content",e[1])},m(s,i){A(document.head,t),e[3](t)},p(e,[s]){2&s&&I(t,"content",e[1])},i:D,o:D,d(s){k(t),e[3](null)}}}function me(e,t,s){let{themeColoredNode:i=null}=t,r=null,a="";return e.$$set=e=>{"themeColoredNode"in e&&s(2,i=e.themeColoredNode)},e.$$.update=()=>{7&e.$$.dirty&&i&&r&&(s(1,a=window.getComputedStyle(i).backgroundColor),s(0,r.content=a,r))},[r,a,i,function(e){_[e?"unshift":"push"]((()=>{r=e,s(0,r),s(2,i),s(1,a)}))}]}M()&&(window.appState=ie,window.DateTime=m,window.Interval=p,window.refreshState=ve,window.checkRecurrencies=ue,ve(),V(ue));class pe extends f{constructor(e){super(),w(this,e,me,he,$,{themeColoredNode:2})}}function fe(e){let t,s,i,r,a,n,c;var o=e[1];function l(e){return{props:{size:e[0]?"20":"28"}}}o&&(s=new o(l(e)));const d=e[4].default,u=O(d,e,e[3],null);return{c(){t=g("button"),s&&S(s.$$.fragment),i=x(),u&&u.c(),this.h()},l(e){t=b(e,"BUTTON",{class:!0});var r=E(t);s&&j(s.$$.fragment,r),i=C(r),u&&u.l(r),r.forEach(k),this.h()},h(){I(t,"class",r="btn btn-lg btn-circle "+e[2].class+" svelte-hznbn8"),N(t,"small",e[0])},m(r,o){T(r,t,o),s&&P(s,t,null),A(t,i),u&&u.m(t,null),a=!0,n||(c=R(t,"click",z(e[5])),n=!0)},p(e,[n]){const c={};if(1&n&&(c.size=e[0]?"20":"28"),o!==(o=e[1])){if(s){L();const e=s;W(e.$$.fragment,1,0,(()=>{B(e,1)})),G()}o?(s=new o(l(e)),S(s.$$.fragment),J(s.$$.fragment,1),P(s,t,i)):s=null}else o&&s.$set(c);u&&u.p&&(!a||8&n)&&F(u,d,e,e[3],a?n:-1,null,null),(!a||4&n&&r!==(r="btn btn-lg btn-circle "+e[2].class+" svelte-hznbn8"))&&I(t,"class",r),5&n&&N(t,"small",e[0])},i(e){a||(s&&J(s.$$.fragment,e),J(u,e),a=!0)},o(e){s&&W(s.$$.fragment,e),W(u,e),a=!1},d(e){e&&k(t),s&&B(s),u&&u.d(e),n=!1,c()}}}function we(e,t,s){let{$$slots:i={},$$scope:r}=t,{small:a=!1}=t,{icon:n=null}=t;return e.$$set=e=>{s(2,t=Y(Y({},t),H(e))),"small"in e&&s(0,a=e.small),"icon"in e&&s(1,n=e.icon),"$$scope"in e&&s(3,r=e.$$scope)},t=H(t),[a,n,t,r,i,function(t){K.call(this,e,t)}]}class $e extends f{constructor(e){super(),w(this,e,we,fe,$,{small:0,icon:1})}}function ge(e){let t,s;const i=e[1].default,r=O(i,e,e[0],null);return{c(){t=g("div"),r&&r.c(),this.h()},l(e){t=b(e,"DIV",{class:!0});var s=E(t);r&&r.l(s),s.forEach(k),this.h()},h(){I(t,"class","absolute bottom-4 right-4 gap-3 items-center inline-flex flex-col")},m(e,i){T(e,t,i),r&&r.m(t,null),s=!0},p(e,[t]){r&&r.p&&(!s||1&t)&&F(r,i,e,e[0],s?t:-1,null,null)},i(e){s||(J(r,e),s=!0)},o(e){W(r,e),s=!1},d(e){e&&k(t),r&&r.d(e)}}}function ye(e,t,s){let{$$slots:i={},$$scope:r}=t;return e.$$set=e=>{"$$scope"in e&&s(0,r=e.$$scope)},[r,i]}class be extends f{constructor(e){super(),w(this,e,ye,ge,$,{})}}export{ee as A,Z as C,be as F,X as R,pe as T,de as a,oe as b,le as c,ce as d,$e as e,ie as f,ne as r,ae as s};
